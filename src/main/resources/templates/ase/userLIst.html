<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<div layout:fragment="content">
  <body>
  <!--**********************************
   Content body start
  ***********************************-->
  <div class="content-body">
    <!-- row -->
    <div class="container-fluid">
      <form id="formSearch">
        <div class="row">
          <div class="col-12">
            <div class="filter cm-content-box box-primary">
              <div class="card-body" style="padding: 1rem">
                <div class="row">
                  <div class="col-7">
                    <input type="text" class="form-control" id="userNm" name="userNm" placeholder="이름">
                  </div>
                  <div class="col-5" style="padding-top: 3px; text-align: right;">
                    <button class="btn btn-success btn-sm" style="margin-right: 5px" type="button" id="btnSave">등록</button>
                    <button class="btn btn-primary btn-sm" type="button" id="btnSearch">검색</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>

      <div class="row">
        <div class="col-12">
          <div class="card border-0 pb-0">
            <div class="card-body p-1">
              <div class="table-responsive">
                <table class="table text-center" id="userGird">
                  <colgroup>
                    <col style="width: 20%;">
                    <col style="width: 8%;">
                    <col style="width: 10%;">
                    <col style="width: 30%;">
                    <col style="width: 12%;">
                  </colgroup>
                  <thead>
                  <tr>
                    <th style=""><b>이름</b></th>
                    <th style=""><b>성별</b></th>
                    <th style=""><b>생년(나이)</b></th>
                    <th style=""><b>전화번호</b></th>
                    <th style=""><b>수정/삭제</b></th>
                  </tr>
                  </thead>
                  <tbody id="tbodyUserList">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    $(document).ready(function() {
      init();

      $('#btnSearch').on('click', () => {
        selectGridList();
      });

      $('#btnSave').on('click', () => {
        window.location.href = '/ase/user/createUser';
      });
    });

    function init() {
      selectGridList();
    };

    const selectGridList = function() {
      JS_COMMON.callAjaxForm('/ase/user/selectUserList', $('#formSearch').serialize(), 'POST', cb_selectGridList, true);
    };

    function cb_selectGridList(resultData) {
      let innerHtml = '';
      if (resultData.data.length === 0) {
        innerHtml = '<li><div class="timeline-panel text-center" style="display: block;"><h4 style="margin-bottom: 0;">조회 결과가 없습니다.</h4></div></li>';
      } else {
        for (const result of resultData.data) {
          innerHtml += '<tr>';
          innerHtml += '<td><span class="w-space-no">' + result.userNm + '</span></td>';
          innerHtml += '<td>' + (result.userSex !== undefined ? result.userSex : '') + '</td>';
          innerHtml += '<td>' + (result.userBirth !== undefined ? result.userBirth : '') + '</td>';
          innerHtml += '<td><a href="tel:' + result.userPhone + '">' + (result.userPhone !== undefined ? result.userPhone : '') + '</a></td>';
          innerHtml += '<td>';
          innerHtml += '<a href="/ase/user/createUser?userUid=' + result.userUid + '" class="btn btn-primary light btn-xxs" style="">수정</a>';
          innerHtml += '<button class="btn btn-danger light btn-xxs" style="margin-left: 5px;" onclick="deleteUser(\'' + result.userUid + '\')">삭제</button>';
          innerHtml += '</td>';
          innerHtml += '</tr>';
        }
      }
      $('#tbodyUserList').html(innerHtml);
    }

    function deleteUser(userUid) {
      if (confirm('Are you sure you want to delete this user?')) {
        JS_COMMON.callAjaxForm('/ase/user/deleteUser', { userUid: userUid }, 'POST', (resultData) => {
          if (resultData.code === 200) {
            alert('User deleted successfully!');
            location.reload(); // Refresh the page
          } else {
            alert('Error occurred: ' + resultData.failMsg);
          }
        }, true);
      }
    }
  </script>

  </body>
</div>
</html>